name: Build Kivy APK

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          sudo apt update
          sudo apt install -y git zip openjdk-17-jdk python3-pip
          pip3 install --upgrade pip setuptools wheel cython buildozer python-for-android kivy kivymd pillow

      - name: Setup Buildozer
        run: |
          buildozer init
          sed -i 's/# android.ndk = 19c/android.ndk = 21b/g' buildozer.spec
          sed -i 's/# android.api = 27/android.api = 31/g' buildozer.spec
          sed -i 's/# android.minapi = 21/android.minapi = 21/g' buildozer.spec
          sed -i 's/# android.archs = arm64-v8a armeabi-v7a/android.archs = arm64-v8a armeabi-v7a/g' buildozer.spec
          sed -i 's/# requirements = python3,kivy/requirements = python3,kivy,kivymd,pillow/g' buildozer.spec

      - name: Build APK
        run: buildozer -v android debug

      - name: Upload APK
        uses: actions/upload-artifact@v3
        with:
          name: RacingGame-APK
          path: bin/*.apk
